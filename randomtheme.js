import{neonTheme}from"./neontheme.js";import{autumnTheme}from"./autumntheme.js";const yearEl=document.getElementById("year");yearEl&&(yearEl.textContent=(new Date).getFullYear().toString());const THEME_STORAGE_KEY="pixelandia-theme",STYLE_ELEMENT_ID="theme-dynamic-styles",RAINBOW_HOLD_MS=1e3,TAP_MAX_MS=220,DEFAULT_THEME_HINT_TEXT="Clique ici pour changer le theme",THEME_HINT_LOADING_TEXTS=["Chargement .","Chargement ..","Chargement ..."],INITIAL_THEME_HINT_MS=4e3,DEFAULT_MENU_THEME_HINT_TEXT="Clique ici pour changer le theme",MENU_THEME_HINT_LOADING_TEXT="Chargement...",rainbowTheme={bodyBg:"linear-gradient(135deg, #f1f5ff, #e7edf8)",bodyColor:"#111111",h1Color:"#111111",h1Shadow:"0 0 6px rgba(255, 255, 255, 0.24),0 0 14px rgba(188, 210, 255, 0.16)",h1Anim:"footerLiseretFlow 5s linear infinite",footerBg:"rgba(255, 255, 255, 0.78)",footerColor:"#111111",footerShadow:"none",footerBeforeBg:"linear-gradient(90deg, #ff9db1, #ffd09d, #fff1a6, #9de9d9, #9cc8ff, #d7b0ff)",footerBeforeShadow:"none",modalBg:"rgba(240, 248, 255, 0.94)",modalTextColor:"#23466e",modalHeadingColor:"#3b6498",modalBorderColor:"rgba(150, 200, 255, 0.3)",modalLinkColor:"#4d88c9",modalCloseColor:"#3b6498",modalScrollbarTrack:"rgba(192, 218, 245, 0.66)",modalScrollbarThumb:"linear-gradient(180deg, #8cc9ff, #c7a6ff)",modalScrollbarThumbHover:"#9bd4ff",footerLinkHoverColor:"#4d88c9",footerLinkHoverShadow:"0 0 10px rgba(77, 136, 201, 0.55)"},availableThemes={neon:neonTheme,autumn:autumnTheme,rainbow:rainbowTheme},themeToggle=document.getElementById("theme-toggle"),themeHint=document.getElementById("theme-toggle-hint"),themeMenuToggle=document.getElementById("theme-menu-toggle"),menuThemeHint=document.querySelector(".dropdown-theme-hint"),navbar=document.querySelector(".navbar"),navbarContactLink=document.getElementById("navbar-contact"),menuContactLink=document.getElementById("menu-contact"),NAVBAR_CONTACT_BREAKPOINT_PX=830;let rainbowHoldTimer=null,rainbowHoldTriggered=!1,rainbowHoldAnimationFrame=null,rainbowHoldStartedAt=0,themeTogglePointerDownAt=0,activeThemeTogglePointerId=null,suppressNextThemeToggleClick=!1,menuRainbowHoldTimer=null,menuRainbowHoldTriggered=!1,menuRainbowHoldAnimationFrame=null,menuRainbowHoldStartedAt=0,menuThemeTogglePointerDownAt=0,menuPreviewRestoreValue=null,menuPreviewRestoreLabel=null,suppressNextMenuThemeToggleClick=!1,themeHintLoadingInterval=null,themeHintLoadingIndex=0,contactInMenu=!1;const getStoredTheme=()=>{try{const e=window.localStorage.getItem(THEME_STORAGE_KEY);if("neon"===e||"autumn"===e||"rainbow"===e)return e}catch{return null}return null},saveTheme=e=>{try{window.localStorage.setItem(THEME_STORAGE_KEY,e)}catch{}},syncNavbarPrimaryLinks=()=>{if(!navbar)return;var e;e=window.innerWidth<830,contactInMenu!==e&&(contactInMenu=e,navbar.classList.toggle("navbar-contact-in-menu",e),navbarContactLink&&(navbarContactLink.setAttribute("aria-hidden",e?"true":"false"),navbarContactLink.tabIndex=e?-1:0),menuContactLink&&(menuContactLink.style.display=e?"block":"none",menuContactLink.setAttribute("aria-hidden",e?"false":"true"),menuContactLink.tabIndex=e?0:-1))},hideThemeHint=()=>{stopThemeHintLoading(!1),document.body.classList.remove("theme-hint-visible"),themeHint&&themeHint.setAttribute("aria-hidden","true")},showThemeHint=()=>{themeHint&&(themeHint.setAttribute("aria-hidden","false"),document.body.classList.add("theme-hint-visible"))},setThemeHintText=e=>{themeHint&&(themeHint.textContent=e)},setMenuThemeHintText=e=>{menuThemeHint&&(menuThemeHint.textContent=e)},getMenuThemeButtonValue=e=>"neon"===e?"normal":"rainbow"===e?Math.random()<.5?"neon":"normal":"neon",getMenuThemeButtonTextFromValue=e=>`Thème : ${e}`,getMenuThemeButtonText=(e,t)=>getMenuThemeButtonTextFromValue(t??getMenuThemeButtonValue(e)),stopThemeHintLoading=(e=!0)=>{null!==themeHintLoadingInterval&&(window.clearInterval(themeHintLoadingInterval),themeHintLoadingInterval=null),e&&setThemeHintText(DEFAULT_THEME_HINT_TEXT)},startThemeHintLoading=()=>{themeHint&&(showThemeHint(),stopThemeHintLoading(!1),themeHintLoadingIndex=0,setThemeHintText(THEME_HINT_LOADING_TEXTS[themeHintLoadingIndex]),themeHintLoadingInterval=window.setInterval(()=>{themeHintLoadingIndex=(themeHintLoadingIndex+1)%THEME_HINT_LOADING_TEXTS.length,setThemeHintText(THEME_HINT_LOADING_TEXTS[themeHintLoadingIndex])},250))},triggerThemeToggleBurst=()=>{themeToggle&&(themeToggle.classList.remove("theme-toggle-burst"),themeToggle.offsetWidth,themeToggle.classList.add("theme-toggle-burst"))},applyTheme=e=>{const t=availableThemes[e];document.body.setAttribute("data-theme",e),document.body.style.backgroundImage=t.bodyBg,document.body.style.color=t.bodyColor,document.documentElement.style.setProperty("--footer-link-hover-color",t.footerLinkHoverColor),document.documentElement.style.setProperty("--footer-link-hover-shadow",t.footerLinkHoverShadow);const n=document.querySelector("h1");n&&(n.style.color=t.h1Color,n.style.textShadow=t.h1Shadow,n.style.animation=t.h1Anim);const o=document.querySelector("footer");o&&(o.style.background=t.footerBg,o.style.color=t.footerColor,o.style.textShadow=t.footerShadow);let a=document.getElementById(STYLE_ELEMENT_ID);a||(a=document.createElement("style"),a.id=STYLE_ELEMENT_ID,document.head.appendChild(a)),a.innerText=`\n  footer::before {\n    background: ${t.footerBeforeBg};\n    background-size: 220% 100%;\n    background-position: 0% 50%;\n    animation: footerLiseretFlow 4s linear infinite;\n    box-shadow: ${t.footerBeforeShadow};\n    opacity: ${"neon"===e?"0.9":"rainbow"===e?"0.85":"1"};\n  }\n\n  #privacy-content {\n    scrollbar-color: ${t.modalCloseColor} transparent;\n  }\n\n  @keyframes privacyScrollGlow {\n    0% {\n      box-shadow: ${t.footerBeforeShadow}, 0 0 10px rgba(255, 255, 255, 0.22), inset 0 0 8px rgba(255, 255, 255, 0.2);\n      filter: brightness(1);\n    }\n    50% {\n      box-shadow: ${t.footerBeforeShadow}, 0 0 24px rgba(255, 255, 255, 0.48), inset 0 0 14px rgba(255, 255, 255, 0.32);\n      filter: brightness(1.12);\n    }\n    100% {\n      box-shadow: ${t.footerBeforeShadow}, 0 0 10px rgba(255, 255, 255, 0.22), inset 0 0 8px rgba(255, 255, 255, 0.2);\n      filter: brightness(1);\n    }\n  }\n\n  #privacy-content::-webkit-scrollbar {\n    width: 14px !important;\n  }\n\n  #privacy-content::-webkit-scrollbar-track {\n    background: rgba(255, 255, 255, 0.05) !important;\n    border-radius: 999px;\n    box-shadow: inset 0 0 14px rgba(255, 255, 255, 0.24) !important;\n  }\n\n  #privacy-content::-webkit-scrollbar-thumb {\n    background: ${t.footerBeforeBg} !important;\n    border-radius: 999px;\n    border: 1px solid rgba(255, 255, 255, 0.18) !important;\n    background-clip: padding-box;\n    box-shadow: ${t.footerBeforeShadow}, 0 0 18px rgba(255, 255, 255, 0.38), inset 0 0 10px rgba(255, 255, 255, 0.28) !important;\n    animation: privacyScrollGlow 1.6s ease-in-out infinite !important;\n    min-height: 56px;\n  }\n\n  #privacy-content::-webkit-scrollbar-thumb:hover {\n    background: ${t.footerBeforeBg} !important;\n    box-shadow: ${t.footerBeforeShadow}, 0 0 36px rgba(255, 255, 255, 0.72), inset 0 0 18px rgba(255, 255, 255, 0.45) !important;\n    filter: brightness(1.2);\n  }\n`;const i=document.getElementById("privacy-content");i&&(i.style.background="transparent",i.style.color=t.modalTextColor,i.style.border="none",i.style.boxShadow="none"),document.querySelectorAll("#privacy-content h1, #privacy-content h2, #privacy-content h3, #privacy-content h4").forEach(e=>{e.style.color=t.modalHeadingColor}),document.querySelectorAll("#privacy-content a").forEach(e=>{e.style.color=t.modalLinkColor});const r=document.getElementById("privacy-close");if(r&&(r.style.color=t.modalCloseColor),themeToggle){themeToggle.setAttribute("data-theme",e);let t="Activer le thème automne";"autumn"===e&&(t="Activer le thème neon"),"rainbow"===e&&(t="Activer le thème neon"),themeToggle.setAttribute("aria-label",t)}if(themeMenuToggle){const t=getMenuThemeButtonValue(e),n=getMenuThemeButtonText(e,t);themeMenuToggle.textContent=n,themeMenuToggle.setAttribute("aria-label",n),themeMenuToggle.setAttribute("data-target-theme",t)}};let activeThemeName=getStoredTheme()??(Math.random()<.5?"neon":"autumn");if(applyTheme(activeThemeName),saveTheme(activeThemeName),window.addEventListener("resize",syncNavbarPrimaryLinks),window.addEventListener("orientationchange",syncNavbarPrimaryLinks),window.requestAnimationFrame(syncNavbarPrimaryLinks),themeToggle){themeToggle.addEventListener("contextmenu",e=>{e.preventDefault()}),themeToggle.addEventListener("touchstart",e=>{e.cancelable&&e.preventDefault()},{passive:!1});const e="--theme-toggle-hold-progress",t=675,n=t=>{const n=Math.min(1,Math.max(0,t));themeToggle.style.setProperty(e,n.toString())},o=e=>{null!==rainbowHoldAnimationFrame&&(window.cancelAnimationFrame(rainbowHoldAnimationFrame),rainbowHoldAnimationFrame=null),themeToggle.classList.remove("theme-toggle-holding"),e&&n(0)},a=()=>{o(!0),themeToggle.style.removeProperty(e),themeToggle.classList.add("theme-toggle-force-reset"),themeToggle.style.pointerEvents="none",window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{themeToggle.classList.remove("theme-toggle-force-reset"),themeToggle.style.pointerEvents=""})}),themeToggle.blur(),null!==activeThemeTogglePointerId&&themeToggle.hasPointerCapture(activeThemeTogglePointerId)&&themeToggle.releasePointerCapture(activeThemeTogglePointerId),activeThemeTogglePointerId=null},i=e=>{const t=e-rainbowHoldStartedAt,o=Math.min(1,Math.max(0,t/1e3)),a=1-Math.pow(1-o,2.6);n(a),rainbowHoldAnimationFrame=t<1e3?window.requestAnimationFrame(i):null},r=()=>{o(!0),rainbowHoldStartedAt=window.performance.now(),themeToggle.classList.add("theme-toggle-holding"),rainbowHoldAnimationFrame=window.requestAnimationFrame(i)},m=(e=!0)=>{const t=null!==rainbowHoldTimer||null!==activeThemeTogglePointerId||themeToggle.classList.contains("theme-toggle-holding");null!==rainbowHoldTimer&&(window.clearTimeout(rainbowHoldTimer),rainbowHoldTimer=null),e?a():o(!0),t&&hideThemeHint()},l=()=>{const e=window.innerWidth<=t;e&&(m(),rainbowHoldTriggered=!1,hideThemeHint()),themeToggle.classList.toggle("theme-toggle-hidden",e),themeToggle.setAttribute("aria-hidden",e?"true":"false"),themeMenuToggle&&themeMenuToggle.classList.toggle("is-visible",e)};themeToggle.addEventListener("pointerdown",e=>{if(!themeToggle.classList.contains("theme-toggle-hidden")){themeTogglePointerDownAt=window.performance.now(),activeThemeTogglePointerId=e.pointerId;try{themeToggle.setPointerCapture(e.pointerId)}catch{}m(!1),startThemeHintLoading(),rainbowHoldTriggered=!1,r(),rainbowHoldTimer=window.setTimeout(()=>{rainbowHoldTimer=null,rainbowHoldTriggered=!0,o(!1),n(1),"rainbow"===activeThemeName?(activeThemeName="neon",applyTheme(activeThemeName),saveTheme(activeThemeName)):(triggerThemeToggleBurst(),activeThemeName="rainbow",applyTheme(activeThemeName),saveTheme(activeThemeName)),n(0),a(),hideThemeHint()},1e3)}}),themeToggle.addEventListener("pointerup",e=>{const t=null!==rainbowHoldTimer,n=Math.max(0,window.performance.now()-themeTogglePointerDownAt)<=220;m(),rainbowHoldTriggered||n||(suppressNextThemeToggleClick=!0),"touch"===e.pointerType&&t&&!rainbowHoldTriggered&&n&&(activeThemeName="neon"===activeThemeName?"autumn":"neon",applyTheme(activeThemeName),saveTheme(activeThemeName),hideThemeHint(),suppressNextThemeToggleClick=!0)}),themeToggle.addEventListener("pointercancel",m),themeToggle.addEventListener("pointerleave",m),themeToggle.addEventListener("touchend",m,{passive:!0}),themeToggle.addEventListener("touchcancel",m,{passive:!0}),window.addEventListener("pointerup",m),window.addEventListener("pointercancel",m),window.addEventListener("blur",m),window.addEventListener("touchend",m,{passive:!0}),window.addEventListener("touchcancel",m,{passive:!0}),themeToggle.addEventListener("click",()=>{suppressNextThemeToggleClick?suppressNextThemeToggleClick=!1:rainbowHoldTriggered?rainbowHoldTriggered=!1:(activeThemeName="neon"===activeThemeName?"autumn":"neon",applyTheme(activeThemeName),saveTheme(activeThemeName),hideThemeHint())}),themeToggle.addEventListener("animationend",e=>{"themeToggleBurst"===e.animationName&&themeToggle.classList.remove("theme-toggle-burst")}),window.addEventListener("resize",l),window.addEventListener("orientationchange",l),window.requestAnimationFrame(l)}if(themeHint&&(setThemeHintText(DEFAULT_THEME_HINT_TEXT),showThemeHint(),window.setTimeout(()=>{hideThemeHint()},4e3)),menuThemeHint&&setMenuThemeHintText(DEFAULT_MENU_THEME_HINT_TEXT),themeMenuToggle){themeMenuToggle.addEventListener("contextmenu",e=>{e.preventDefault()}),themeMenuToggle.addEventListener("touchstart",e=>{e.cancelable&&e.preventDefault()},{passive:!1});const e="--theme-menu-hold-progress",t=t=>{const n=Math.min(1,Math.max(0,t));themeMenuToggle.style.setProperty(e,n.toString())},n=e=>{null!==menuRainbowHoldAnimationFrame&&(window.cancelAnimationFrame(menuRainbowHoldAnimationFrame),menuRainbowHoldAnimationFrame=null),themeMenuToggle.classList.remove("theme-menu-holding"),e&&t(0)},o=e=>{const n=e-menuRainbowHoldStartedAt,a=Math.min(1,Math.max(0,n/1e3));t(a),menuRainbowHoldAnimationFrame=n<1e3?window.requestAnimationFrame(o):null},a=()=>{n(!0),menuRainbowHoldStartedAt=window.performance.now(),themeMenuToggle.classList.add("theme-menu-holding"),menuRainbowHoldAnimationFrame=window.requestAnimationFrame(o)},i=(e=!0)=>{null!==menuRainbowHoldTimer&&(window.clearTimeout(menuRainbowHoldTimer),menuRainbowHoldTimer=null),n(!0);const t=themeMenuToggle.classList.contains("theme-menu-preview-rainbow");if(themeMenuToggle.classList.remove("theme-menu-preview-rainbow"),e){const e=themeMenuToggle.getAttribute("data-target-theme"),n="normal"===e||"neon"===e?e:null,o=t&&menuPreviewRestoreValue?menuPreviewRestoreValue:"rainbow"===activeThemeName&&n?n:getMenuThemeButtonValue(activeThemeName),a=t&&menuPreviewRestoreLabel?menuPreviewRestoreLabel:"rainbow"===activeThemeName&&themeMenuToggle.textContent?themeMenuToggle.textContent:getMenuThemeButtonTextFromValue(o);themeMenuToggle.textContent=a,themeMenuToggle.setAttribute("aria-label",a),themeMenuToggle.setAttribute("data-target-theme",o)}menuPreviewRestoreValue=null,menuPreviewRestoreLabel=null,setMenuThemeHintText(DEFAULT_MENU_THEME_HINT_TEXT)};themeMenuToggle.addEventListener("pointerdown",()=>{menuThemeTogglePointerDownAt=window.performance.now();const e=themeMenuToggle.getAttribute("data-target-theme"),o=themeMenuToggle.textContent;i(!1),menuPreviewRestoreValue="normal"===e||"neon"===e?e:null,menuPreviewRestoreLabel=o,"rainbow"!==activeThemeName&&(themeMenuToggle.classList.add("theme-menu-preview-rainbow"),themeMenuToggle.textContent="Thème : rainbow",themeMenuToggle.setAttribute("aria-label","Thème : rainbow"),themeMenuToggle.setAttribute("data-target-theme","rainbow")),setMenuThemeHintText("Chargement..."),menuRainbowHoldTriggered=!1,a(),menuRainbowHoldTimer=window.setTimeout(()=>{if(menuRainbowHoldTimer=null,menuRainbowHoldTriggered=!0,n(!1),t(1),"rainbow"===activeThemeName){const e=menuPreviewRestoreValue??("normal"===themeMenuToggle.getAttribute("data-target-theme")?"normal":"neon"===themeMenuToggle.getAttribute("data-target-theme")?"neon":null),t="neon"===e?"neon":"normal"===e?"autumn":null;t&&(activeThemeName=t,applyTheme(activeThemeName),saveTheme(activeThemeName))}else activeThemeName="rainbow",applyTheme(activeThemeName),saveTheme(activeThemeName);hideThemeHint()},1e3)}),themeMenuToggle.addEventListener("pointerup",e=>{const t=null!==menuRainbowHoldTimer,n=Math.max(0,window.performance.now()-menuThemeTogglePointerDownAt)<=220;i(),menuRainbowHoldTriggered||n||(suppressNextMenuThemeToggleClick=!0),"touch"===e.pointerType&&t&&!menuRainbowHoldTriggered&&n&&(activeThemeName="neon"===activeThemeName?"autumn":"neon",applyTheme(activeThemeName),saveTheme(activeThemeName),hideThemeHint(),suppressNextMenuThemeToggleClick=!0)}),themeMenuToggle.addEventListener("pointercancel",i),themeMenuToggle.addEventListener("pointerleave",i),themeMenuToggle.addEventListener("click",()=>{if(suppressNextMenuThemeToggleClick)suppressNextMenuThemeToggleClick=!1;else{if(menuRainbowHoldTriggered)return menuRainbowHoldTriggered=!1,void t(0);activeThemeName="neon"===activeThemeName?"autumn":"neon",applyTheme(activeThemeName),saveTheme(activeThemeName),hideThemeHint()}})}